language: swift
osx_image: xcode11.3

addons:
  artifacts:
    paths:
      - $(ls *.zip | tr "\n" ":")

branches:
  only:
    - dev
    - staging
    - production

stages:
  - verify
  - framework
  - name: deploy
    if: NOT(type = pull_request)

jobs:
  include:
    - stage: verify
      name: unit_test
      script:
        - bundle install
        - bundle exec fastlane unit_test
    - stage: verify
      name: ui_test
      script:
        - bundle install
        - bundle exec fastlane ui_test
    - stage: framework
      name: xcframework
      script:
        - bundle install
        - bundle exec fastlane framework
        - bundle exec fastlane zipArtifacts
    - stage: deploy
      name: testflight
      script:
        - bundle install
        - BUILD_NUMBER=$TRAVIS_BUILD_NUMBER bundle exec fastlane beta
    # Currently disabled until travis and see dev endpoints or a local service can be spun up
    # - stage: test
    #   name: integration_test
    #   script:
    #     - bundle install
    #     - bundle exec fastlane integration_test 
